  
在讨论MVC模式时，我们看到它为PHP提供了很好的适配性，特别是因为PHP具有非常清晰的请求/响应循环。每当有新的请求到达时，一个新的进程就会启动，并从头开始启动我们的PHP应用程序。
  
这个特性使得PHP非常容易上手：你不需要任何编译器，也不需要处理跨请求的共享状态或担心内存管理；它非常简单。
  
然而，并不总是偏好简单。PHP社区中有一个越来越受欢迎的群体：异步社区。在本书中提到它们是值得的，因为最近对于异步PHP有越来越多的用例。现代PHP不仅用于支持博客或小型公司网站；它还用于构建大规模的Web应用程序，并且有些情况下异步编程能够带来显著的价值。

首先明确一点：我无法在本章节中深入解释异步编程。解释异步编程需要一本专门的书。本章的目标是让你了解PHP中的选项。所以我会假设你了解一些与异步相关的词汇。如果不是这样，不用担心，它仍然是一篇有趣的阅读，但如果你对这个主题感兴趣，可能需要进行一些后续研究。在这种情况下，我建议你看看JavaScript社区，他们对异步编程的接受程度超过其他任何语言，并且有很多学习异步思维方式的优质资源。

通过“异步PHP”，我们指的是一个PHP进程可以同时处理多个任务。
  
您可以使用线程或创建子进程，每个子进程专门用于一个任务。而父进程将监视和管理所有这些子进程。例如，您可以为每个请求创建一个子进程，并与父进程共享已加载和启动的框架，而不是在每个请求上从头开始启动。
  
然而，异步不仅仅是管理子进程。想象一下处理I/O，比如读取文件或与外部服务通信。您可以在执行下一个查询之前，执行所有查询并等待结果。假设您有十个查询，每个查询需要一秒钟执行，您可以在一秒钟内同时运行所有查询，而不是十秒钟。
  
简而言之，如果正确使用，异步编程可以显著提高性能。
  
大多数MVC框架并没有针对异步思维进行优化：它们假设每次有新的请求进来时都需要从头开始启动。为此，它们尝试通过缓存和将配置编译成优化的生产就绪版本来优化该过程的某些部分。你可能本能地认为，如果能够跳过框架的“启动阶段”，就能看到巨大的性能提升；然而，情况并非完全如此。
  
你看，PHP中拥有“共享应用状态”并且并行处理请求并不会有显著的区别：你的Web服务器已经在并行处理请求时运行了多个进程。此外，你可以使用预加载来将应用程序引导并准备好放入内存中。最大的性能提升来自于异步处理I/O，而大多数框架并没有针对此进行优化。它们没有以异步思维构建。这没关系，因为对于许多项目来说，异步PHP增加了一层过度复杂性。

鉴于此，你不应该期望仅仅通过将MVC框架和Amp或ReactPHP等异步框架结合起来就能获得突破性的性能提升 - 这不仅仅是这样。异步有更多有趣的用例，超出了普通MVC应用程序的范畴。

  
在2020年，Laravel推出了一种名为"Octane"的异步编程的一方集成。它需要一些专用的服务器设置，并对编写代码施加了一些限制，因为该框架基本上只启动一次，并在多个请求之间共享。
  
Octane是异步PHP领域可能性的完美示例，但也表明它需要更多的努力才能使一切顺利运行。如果您想了解更多信息，可以查看这个很好的文档页面：https://laravel.com/docs/8.x/octane。
  
考虑一下需要进行大量实时重型计算的复杂API。当我在社区中询问有关异步PHP的实际用例的人时，有人告诉我他们使用Swoole来运行他们的API。Swoole使他们能够在进程间静态缓存数据，以减少数据库I/O并并行进行复杂计算。总的来说，他们能够每秒处理8000个请求，而不是600个。
  
我刚才提到了Swoole，还谈到了Amp（全称为Amphp）和ReactPHP。这些是当今最流行的三个异步框架。
  
Amp和ReactPHP是使用PHP本身实现的。您可以在以下位置下载它们：
  
使用composer进行项目管理，然后你就可以开始了。另一方面，Swoole是一个需要在系统上安装的PHP扩展。虽然ReactPHP自称为“基于事件驱动的非阻塞I/O的PHP框架”，而Swoole则是一个“基于协程的异步PHP编程框架”。

除了完整的异步框架外，还有流行的Guzzle HTTP库，可以并行执行HTTP请求。这是一种更简单和独立的异步编程方法，但也有几种使用情况。比如，如果你从一个分页的API加载数据，你可以同时加载多个页面，而不是一个一个地加载。
  
每个框架都有自己的目标受众和需求，它们都是受欢迎的选择，并且在生产环境中被广泛使用。

你可以在另一个我遇到的真实案例中下载它们。这个平台定期使用AWS Lambda发送10万个推送通知。他们没有生成10万个Lambda，而是将数据分成500个一组，并将每组并行发送给总共200个Lambda。他们使用Guzzle同时执行200个HTTP请求，并等待它们全部完成。每个Lambda依次也会并行发送500个推送通知，并在不到一分钟内完成。总的来说，由于异步编程，发送10万个推送通知只需要2分钟。
  
人们有时会将PHP与NodeJS进行比较，并提到它缺乏异步能力，但事实恰恰相反。在PHP中有很多异步编程的选项。它们在各种用例中已经在生产环境中使用。PHP与JavaScript的不同之处在于它没有内置的异步编程支持，如async、await或promises。然而，PHP 8.1支持纤程（也称为其他语言中的"绿色线程"），我们将在下一章中深入研究它们。

也有一些对在PHP核心中添加libuv的适度兴趣，这是支持Node异步能力的同一库。尽管还没有尝试将其集成，但也许PHP将来会拥有内置的异步引擎。

直到那时，已经有很多经过验证的优秀解决方案可以立即使用。

